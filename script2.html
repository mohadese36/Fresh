<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Transparent Recolor & Download</title>
<style>
  body{background:#1e1e1e;color:#fff;text-align:center;font-family:sans-serif;padding:24px}
  canvas{max-width:90vw;background:transparent;border:1px dashed #555;margin-top:1rem}
  .swatch{width:30px;height:30px;border-radius:50%;border:none;cursor:pointer;margin:5px}
</style>
</head>
<body>
<h2>ğŸ¨ Change Image Color (Keep Transparency)</h2>

<input type="file" id="upload" accept="image/*"><br><br>

<div id="palette">
  <button class="swatch" data-color="#2ea043" style="background:#2ea043" title="Green"></button>
  <button class="swatch" data-color="#ff7a00" style="background:#ff7a00" title="Orange"></button>
  <button class="swatch" data-color="#e63946" style="background:#e63946" title="Red"></button>
  <button class="swatch" data-color="#7a4a28" style="background:#7a4a28" title="Brown"></button>
  <button class="swatch" data-color="#b87333" style="background:#b87333" title="Copper"></button>
</div>

<canvas id="canvas"></canvas><br>
<button id="download">Download Recolored PNG</button>

<script>
const upload = document.getElementById('upload');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const palette = document.getElementById('palette');
const downloadBtn = document.getElementById('download');

let img = new Image();
let tintColor = '#b87333'; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø³ÛŒ

function recolor() {
  if (!img.complete || !img.naturalWidth) return;
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  
  // 1. ØªØµÙˆÛŒØ± Ø±Ø§ Ø¨Ú©Ø´
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(img, 0, 0);

  // 2. Ø¯Ø§Ø¯Ù‡â€ŒÛŒ Ù¾ÛŒÚ©Ø³Ù„ÛŒ Ø±Ø§ Ø¨Ú¯ÛŒØ±
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;

  // 3. Ø±Ù†Ú¯ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø±Ø§ Ø¨Ù‡ RGB ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†
  const hex = tintColor.replace('#', '');
  const rTint = parseInt(hex.substring(0,2), 16);
  const gTint = parseInt(hex.substring(2,4), 16);
  const bTint = parseInt(hex.substring(4,6), 16);

  // 4. Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù¾ÛŒÚ©Ø³Ù„ ØºÛŒØ±Ø´ÙØ§ÙØŒ Ø±Ù†Ú¯ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
  for (let i = 0; i < data.length; i += 4) {
    const alpha = data[i + 3];
    if (alpha > 10) { // ÙÙ‚Ø· Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§ÛŒ ØºÛŒØ± Ø´ÙØ§Ù
      data[i] = (data[i] + rTint) / 2; // Ù‚Ø±Ù…Ø²
      data[i + 1] = (data[i + 1] + gTint) / 2; // Ø³Ø¨Ø²
      data[i + 2] = (data[i + 2] + bTint) / 2; // Ø¢Ø¨ÛŒ
    }
  }

  // 5. Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
  ctx.putImageData(imageData, 0, 0);
}

upload.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  img = new Image();
  img.onload = () => {
    recolor();
    URL.revokeObjectURL(url);
  };
  img.src = url;
});

palette.addEventListener('click', e => {
  const btn = e.target.closest('.swatch');
  if (!btn) return;
  tintColor = btn.dataset.color;
  recolor();
});

downloadBtn.addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = 'recolored.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});
</script>
</body>
</html>
